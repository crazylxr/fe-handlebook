<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript是如何工作的 | 前端桃园手册</title>
    <meta name="description" content="让前端变得更简单">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.b1cbcfde.css" as="style"><link rel="preload" href="/assets/js/app.4b1516c6.js" as="script"><link rel="preload" href="/assets/js/2.4455a399.js" as="script"><link rel="preload" href="/assets/js/36.19144546.js" as="script"><link rel="prefetch" href="/assets/js/10.342c20f7.js"><link rel="prefetch" href="/assets/js/11.2684930f.js"><link rel="prefetch" href="/assets/js/12.b06cc777.js"><link rel="prefetch" href="/assets/js/13.22cf5677.js"><link rel="prefetch" href="/assets/js/14.d8c082b5.js"><link rel="prefetch" href="/assets/js/15.298c3c45.js"><link rel="prefetch" href="/assets/js/16.5345eec5.js"><link rel="prefetch" href="/assets/js/17.87f50e28.js"><link rel="prefetch" href="/assets/js/18.218e8def.js"><link rel="prefetch" href="/assets/js/19.6111b019.js"><link rel="prefetch" href="/assets/js/20.42203713.js"><link rel="prefetch" href="/assets/js/21.9ea8e678.js"><link rel="prefetch" href="/assets/js/22.9e6b5696.js"><link rel="prefetch" href="/assets/js/23.ce5a1dcf.js"><link rel="prefetch" href="/assets/js/24.7728094a.js"><link rel="prefetch" href="/assets/js/25.9c5b34d0.js"><link rel="prefetch" href="/assets/js/26.cc457d7a.js"><link rel="prefetch" href="/assets/js/27.a1f5e3cd.js"><link rel="prefetch" href="/assets/js/28.256d4fff.js"><link rel="prefetch" href="/assets/js/29.2f6f3c59.js"><link rel="prefetch" href="/assets/js/3.ee8f4971.js"><link rel="prefetch" href="/assets/js/30.a426a340.js"><link rel="prefetch" href="/assets/js/31.a24d6c4d.js"><link rel="prefetch" href="/assets/js/32.e9c40861.js"><link rel="prefetch" href="/assets/js/33.56b6d2d0.js"><link rel="prefetch" href="/assets/js/34.50b4ffde.js"><link rel="prefetch" href="/assets/js/35.1f83ac9c.js"><link rel="prefetch" href="/assets/js/37.aefe1b94.js"><link rel="prefetch" href="/assets/js/38.e3b14993.js"><link rel="prefetch" href="/assets/js/39.43b42f39.js"><link rel="prefetch" href="/assets/js/4.42eb01a9.js"><link rel="prefetch" href="/assets/js/40.ba59c2e6.js"><link rel="prefetch" href="/assets/js/41.c6dcbe49.js"><link rel="prefetch" href="/assets/js/42.a178911b.js"><link rel="prefetch" href="/assets/js/43.031edee8.js"><link rel="prefetch" href="/assets/js/44.3eb861f0.js"><link rel="prefetch" href="/assets/js/45.d6fae1b5.js"><link rel="prefetch" href="/assets/js/46.a7cdfef9.js"><link rel="prefetch" href="/assets/js/47.a21bd9f6.js"><link rel="prefetch" href="/assets/js/48.8e4b2a78.js"><link rel="prefetch" href="/assets/js/5.f013b3c6.js"><link rel="prefetch" href="/assets/js/6.e2b639a4.js"><link rel="prefetch" href="/assets/js/7.36ef9f23.js"><link rel="prefetch" href="/assets/js/8.976983c0.js"><link rel="prefetch" href="/assets/js/9.9032491a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b1cbcfde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端桃园手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/dt6ox9.html" class="sidebar-link">介绍</a></li><li><a href="/uc5l5a.html" class="sidebar-link">HTML</a></li><li><section class="sidebar-group depth-0"><a href="/hu5fdh.html" class="sidebar-heading clickable"><span>CSS</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/na22ae.html" class="sidebar-link">BFC</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/mrohx3.html" class="sidebar-heading clickable open"><span>JavaScript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ny4sy0.html" class="active sidebar-link">JavaScript是如何工作的</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ny4sy0.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#简单介绍" class="sidebar-link">简单介绍</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#v8" class="sidebar-link">V8</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#宿主" class="sidebar-link">宿主</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#v8-执行流程" class="sidebar-link">v8 执行流程</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#运行时环境" class="sidebar-link">运行时环境</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#javascript-引擎" class="sidebar-link">JavaScript 引擎</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#运行" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#调用堆栈" class="sidebar-link">调用堆栈</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#任务队列-消息队列" class="sidebar-link">任务队列(消息队列)</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#并发和事件循环" class="sidebar-link">并发和事件循环</a></li><li class="sidebar-sub-header"><a href="/ny4sy0.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/wndkvu.html" class="sidebar-link">原型、构造函数、实例</a></li><li><a href="/txwio3.html" class="sidebar-link">词法环境、执行上下文、作用域、闭包</a></li><li><a href="/npo9qk.html" class="sidebar-link">ES6</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/bpv9rg.html" class="sidebar-heading clickable"><span>框架</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ikypbn.html" class="sidebar-link">Vue</a></li><li><a href="/gxcr94.html" class="sidebar-link">React</a></li></ul></section></li><li><a href="/ptoast.html" class="sidebar-link">自动化测试</a></li><li><section class="sidebar-group depth-0"><a href="/tz88n4.html" class="sidebar-heading clickable"><span>计算机通识</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/aqhnhg.html" class="sidebar-link">设计模式</a></li><li><a href="/dol4m6.html" class="sidebar-link">操作系统</a></li><li><a href="/lakekx.html" class="sidebar-link">网络</a></li><li><a href="/wrrb0y.html" class="sidebar-link">Git</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/wm8tcg.html" class="sidebar-heading clickable"><span>算法和数据结构</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/bwdihs.html" class="sidebar-link">二叉树</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/tpemfk.html" class="sidebar-heading clickable"><span>工程化</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tfi01u.html" class="sidebar-link">Babel</a></li><li><a href="/saraly.html" class="sidebar-link">Webpack</a></li><li><a href="/xbrnpe.html" class="sidebar-link">脚手架</a></li><li><a href="/bcc99c.html" class="sidebar-link">部署</a></li><li><a href="/lr4cin.html" class="sidebar-link">埋点</a></li><li><a href="/ytk5vc.html" class="sidebar-link">监控</a></li></ul></section></li><li><a href="/wk3rnk.html" class="sidebar-link">Node</a></li><li><a href="/hg0gpt.html" class="sidebar-link">安全</a></li><li><a href="/isl5no.html" class="sidebar-link">性能优化</a></li><li><section class="sidebar-group depth-0"><a href="/stmpud.html" class="sidebar-heading clickable"><span>其他</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/fzu9u4.html" class="sidebar-link">Serverless</a></li><li><a href="/vt7k5r.html" class="sidebar-link">微前端</a></li><li><a href="/qsxi2z.html" class="sidebar-link">浏览器</a></li><li><a href="/nagu8e.html" class="sidebar-link">函数式</a></li><li><a href="/yqro45.html" class="sidebar-link">面试</a></li><li><a href="/wuodrm.html" class="sidebar-link">社区或者博客</a></li><li><a href="/fwzwt9.html" class="sidebar-link">编写可维护的代码</a></li><li><a href="/vkghcf.html" class="sidebar-link">Rxjs</a></li><li><a href="/bg9fcf.html" class="sidebar-link">Typescript</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/hh3dec.html" class="sidebar-heading clickable"><span>工具</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/lmt8ty.html" class="sidebar-link">VSCode</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript是如何工作的"><a href="#javascript是如何工作的" class="header-anchor">#</a> JavaScript是如何工作的</h1> <div data-lake-element="root" class="lake-content-editor-core lake-engine lake-typography-traditional"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p data-lake-id="b4de6a2775ed5dfa04e2d7b70a381778" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">当我想到要写这个标题的时候，就知道是一篇很长、很难写的文章，并且由于不能结合实战，可能比较枯燥，导致很少有人把文章看完，所以我尽可能将文章写得有趣，让你在不知不觉中把文章看完。</p><p data-lake-id="eda15a462383b8bf3d5cf44a9bf74c36" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586266624175-72e08061-b475-488d-af39-52328a673d98.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586266624175-72e08061-b475-488d-af39-52328a673d98.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:299px;height:266px;"></span></p> <h2 id="简单介绍"><a href="#简单介绍" class="header-anchor">#</a> 简单介绍</h2> <p data-lake-id="af114dc5d47e07818340ef658524b567" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">说到 JavaScript 是如何工作的，可能很多人脑子想到的词语是：v8、事件循环、执行上下文、调用栈等。不过有想过他们有什么关系，到底是怎么联系起来工作的么？</p><p data-lake-id="3b2c15c3eb6af9df9abf6e3d6ef79077" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><blockquote style="margin-top:5px;margin-bottom:5px;padding-left:1em;margin-left:0px;border-left:3px solid rgb(238, 238, 238);opacity:0.6;"><p data-lake-id="64f684689846b7b238395ef0538baae9" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">TODO：有了解析器不确定 JavaScript 是否是解释型语言</p></blockquote><p data-lake-id="34dbdb55a2a1356b1f371b32be221365" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">首先我们要知道 JavaScript 是一个解释型语言(在每次运行时都需要通过解释器对程序进行动态解释和执行)，那么就需要一个解释器将 JavaScript 的源代码翻译成为计算机能懂的机器码，解析器的大致执行步骤如下：</p><p data-lake-id="fa640b4368ff85b573e46ecf967a2b40" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586267704855-d0bff14a-f819-412d-bb63-354f5c066f0b.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586267704855-d0bff14a-f819-412d-bb63-354f5c066f0b.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:519px;height:111px;"></span></p><blockquote style="margin-top:5px;margin-bottom:5px;padding-left:1em;margin-left:0px;border-left:3px solid rgb(238, 238, 238);opacity:0.6;"><p data-lake-id="4d9b028d36f075564c98980fcf5aa1e5" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">图片来自于李兵老师在极客时间的专栏的《浏览器工作原理与实践》</p></blockquote><p data-lake-id="9513a462b1c22913027a24ccdad398f4" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"> 对于解析 JavaScript 的解释器可以称为<strong> JavaScript 解释器，</strong>更高大上的名字就是 <strong>JavaScript 引擎。</strong>市面上众多的 JavaScript 引擎，最出名的莫过于谷歌开发的 <strong>v8 引擎，</strong>所以吧，v8 引擎其实就是个 JavaScript 解释器。</p><p data-lake-id="48d67496645e1eb634ac6f3642d72dbf" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586268351409-eccd4106-356b-40bb-b1cc-a48e03326b7f.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586268351409-eccd4106-356b-40bb-b1cc-a48e03326b7f.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:295px;height:314px;"></span></p><p data-lake-id="05c715407fdcbda72f584ea1ec3f470a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">为什么要让你知道 v8 其实仅仅是个解释器呢，因为接下来你需要知道 v8 其实是个「病毒」，没办法自己生存，虽然可以编译成机器码，但是在执行的时候所需要的内存、事件循环、消息队列，以及各种乱七八糟的「营养」，是他所没有的，需要找一个宿主环境给它提供「营养物质」。</p><p data-lake-id="a8105f2f7dfb280cf803c8d6a63f6046" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">需要「营养物质」嘛，刚好咱们的浏览器可以提供(Node.js 也可以提供)，可以给它当宿主，这样 v8 可以愉快的编译并执行 JavaScript 代码了。</p><blockquote style="margin-top:5px;margin-bottom:5px;padding-left:1em;margin-left:0px;border-left:3px solid rgb(238, 238, 238);opacity:0.6;"><p data-lake-id="b3ea38480bc4c2eb20d86c43878d583b" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">我这里想表达的是在 JavaScript 执行代码的时候，堆栈空间(TODO：这个还不确定)、事件循环、消息队列等东西是宿主环境提供的，不是 v8 提供的。</p></blockquote><p data-lake-id="b356c9876cd0b3c0d03bae4c237fbba0" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">比如在浏览器中宿主与 v8 的关系是这样：</p><p data-lake-id="5d6913df4f4bfe42a413f6c6c305a0b2" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586269181453-dfabf0f2-63c4-4e80-b115-3425e957d208.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586269181453-dfabf0f2-63c4-4e80-b115-3425e957d208.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:457px;height:309px;"></span></p><p data-lake-id="b49c4cd9a0d77e8486ad2f81486cfb70" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586269249474-2e55f378-a0c5-41b4-adae-cda88d18a6d3.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586269249474-2e55f378-a0c5-41b4-adae-cda88d18a6d3.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:148px;height:131px;"></span></p><p data-lake-id="dc509a6e7b056b155e8633dfdb3e256a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="9df2761dc9588f1fbf590230a2d2f23d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">这个时候我们大概知道了 JavaScript 是怎么运行的，接下来就具体的去介绍 V8 和宿主环境是怎么一起工作的。</p> <h2 id="v8"><a href="#v8" class="header-anchor">#</a> V8</h2> <p data-lake-id="a35092510f6ef3c128264b1799dba9af" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(51, 51, 51);font-size:15px;"><span>对JS代码进行词法、语法等分析，通过编译器将代码编译成可执行的机器码让计算机去执行。</span></span></p> <h2 id="宿主"><a href="#宿主" class="header-anchor">#</a> 宿主</h2> <p data-lake-id="d6f27d97dcb3c7f7f7a08a1b09d7fb4b" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p> <h2 id="v8-执行流程"><a href="#v8-执行流程" class="header-anchor">#</a> v8 执行流程</h2> <p data-lake-id="32d5b67055ad565a533e3437850d4650" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">在 v8 去执行代码前，会初始化一些必要的基础环境，包括：堆栈空间、全局执行上下文、全局作用域、事件循环系统等。</p><p data-lake-id="b78e3626833a76a7b67d26fb73793dc7" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">然后解析器对源代码进行解析，生成<strong> AST</strong> 和<strong>作用域，</strong>再根据语义分析生成中间代码(也可称为字节码)，最后解析器进行代码解析并执行，输出结果。</p><p data-lake-id="9039c56ad2ac17c164c1fcd33fc6ca28" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">为了优化 JIT 技术，可以将热点代码进行编译生成机器码，再输出结果。</p> <h2 id="运行时环境"><a href="#运行时环境" class="header-anchor">#</a> 运行时环境</h2> <p data-lake-id="e02bc8a9268a6dbcb9d837a56a2ed1c0" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">我们要知道在 chrome 中，一个标签页就是一个进程，也就是说 v8 和浏览器的主线程是公用一套内存空间，也就是下面的堆和栈空间。</p> <h3 id="堆和栈空间"><a href="#堆和栈空间" class="header-anchor">#</a> 堆和栈空间</h3> <p data-lake-id="d03f08a73e158b2e1501a546466959d4" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">当 JavaScript 在执行之前，宿主环境需要初始化一些内存空间，用来存放 JavaScript 执行的时候所用到的各种对象以及执行环境。</p><p data-lake-id="b98c2a030076a955e16c6ea6e052a5a0" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">我们比较关注的就是栈内存和堆内存。</p><p data-lake-id="b7859f6eb1ba1e7edd84b990b9e28263" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586304292958-ff4f2631-10e7-4bdf-870a-083175a29614.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586304292958-ff4f2631-10e7-4bdf-870a-083175a29614.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:395px;height:528px;"></span></p><p data-lake-id="cba74b8a8700e27e80641fe076ae6903" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">其中栈空间是用于管理 JavaScript 函数的调用，在函数调用过程中，涉及到上下文相关的内容都会存放在栈上，比如原生类型、引用到的对象的地址、函数的执行状态、this 值等都会存在在栈上。当一个函数执行结束，那么该函数的执行上下文便会被销毁掉。</p><p data-lake-id="1e43fcc1035d27f33e5160fde7083878" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="fe4a1d519ad996f277a2f951fcb24b71" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">堆空间是一种树形的存储结构，用来存储对象类型的离散的数据，在前面的课程中我们也讲过，JavaScript 中除了原生类型的数据，其他的都是对象类型，诸如函数、数组，在浏览器中还有 window 对象、document 对象等，这些都是存在堆空间的。</p><p data-lake-id="fffefc57517ffb08767ed776a20d37e1" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="d3fb01bdac6d19a26e15a8e412282af5" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">宿主在启动 V8 的过程中，会同时创建堆空间和栈空间，再继续往下执行，产生的新数据都会存放在这两个空间中。</p><p data-lake-id="b5d357a47e688ce154516d08cfafa8f9" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="6918246f67a1bcb8c3a11f83e3b40318" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586304421476-ba9e8069-5d99-4dcf-bba0-e23f30d8b25b.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586304421476-ba9e8069-5d99-4dcf-bba0-e23f30d8b25b.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:486px;height:270px;"></span></p><p data-lake-id="7ba0c2e8de06b5d1caaf99c6b919782d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="f5a0701ff979d37e0581a3090cf33a91" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">执行上下文里面就包括了<strong>词法环境、变量环境</strong>和<strong> this</strong>。</p><p data-lake-id="5a824ab6bd16c98d73391aba4c42a050" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586318006485-fe0f11b1-106e-470a-b240-a66c1747dbbd.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586318006485-fe0f11b1-106e-470a-b240-a66c1747dbbd.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:117px;height:112px;"></span></p><p data-lake-id="19bc7a7ac5ade05b4a8fcc2502a96b3d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">为啥要放执行上下文，执行上下文又是干啥的呢？</p><p data-lake-id="cd827cd904c53f8cca0895705dddfa9d" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="9da8da577832035c815740e120de12fa" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p> <h3 id="消息队列"><a href="#消息队列" class="header-anchor">#</a> 消息队列</h3> <h3 id="事件循环"><a href="#事件循环" class="header-anchor">#</a> 事件循环</h3> <h3 id="web-api"><a href="#web-api" class="header-anchor">#</a> Web API</h3> <h2 id="javascript-引擎"><a href="#javascript-引擎" class="header-anchor">#</a> JavaScript 引擎</h2> <p data-lake-id="74ddd9873c9c582ce6daba2c0cd42f19" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;">其实在执行 JavaScript 代码之前，V8 就已经准备好了代码的运行时环境，这个环境包括了堆空间和栈空间、全局执行上下文、全局作用域、内置的内建函数、宿主环境提供的扩展函数和对象，还有消息循环系统。准备好运行时环境之后，V8 才可以执行 JavaScript 代码，这包括解析源码、生成字节码、解释执行或者编译执行这一系列操作。</span></p><p data-lake-id="fa092e4c342926e5025139615ef42100" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;"><br></span></p><p data-lake-id="cd43e3bad48798841f6013bf3ccaf49f" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;">事件循环系统可以让你清楚各种回调函数是怎么被执行的，栈空间可以让你了解函数是怎么被调用的，堆空间和栈空间让你了解为什么要有传值和传引用</span></p><p data-lake-id="d99e4d69e6fd15880c1c99402bce375a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;"><br></span></p><p data-lake-id="8ac53ddfa73f9514def84372d8198e33" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586265191796-7abc1367-483a-44c4-a656-c581519bbf0f.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586265191796-7abc1367-483a-44c4-a656-c581519bbf0f.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:585px;height:307px;"></span></span></p><p data-lake-id="2d77ef2ccce385fabfb6b4fc05f14f91" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;"><br></span></p><p data-lake-id="fa8ba0384bcb4a1cdc5ee59ef01ffdb6" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586265571881-553f2786-3a32-42e7-808f-3c1b1815f7c8.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1586265571881-553f2786-3a32-42e7-808f-3c1b1815f7c8.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:513px;height:275px;"></span></span></p><p data-lake-id="39a503b9cfbe8a801d48b7fc0af2abd8" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 12px" class="lake-fontsize-12" style="color:rgb(51, 51, 51);font-size:16px;"><br></span></p><p data-lake-id="82482bde2f2e83dd65b67d11fbdda963" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(51, 51, 51);font-size:15px;">JS引擎主要是对JS代码进行词法、语法等分析，通过编译器将代码编译成可执行的机器码让计算机去执行。</span></p><p data-lake-id="a4a7c5fab0c332b7b25ef6c6fde3337c" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1585533301451-d264cb63-3938-43c6-9a13-7bf66959b8cb.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1585533301451-d264cb63-3938-43c6-9a13-7bf66959b8cb.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:620px;height:455px;"></span></p><p data-lake-id="a20d224c568e48b9d67847a2c66a8c01_p_0" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">引擎主要由两个组件组成：</p><ul data-lake-id="3a632cd5ee8b120eb96a867c0ffb1cba" lake-indent="0" style="list-style-type:disc;margin:0px;padding-left:23px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;"><li data-lake-id="8949d1ab1007bcdc9297b9ee56c14890">内存堆（Memory Heap ）：这是内存分配的地方</li><li data-lake-id="6c64d7b4684a8a625cf76a7e7a62c1a8">调用堆栈（Call Stack）：这是程序运行时函数的调用过程</li></ul><blockquote style="margin-top:5px;margin-bottom:5px;padding-left:1em;margin-left:0px;border-left:3px solid rgb(238, 238, 238);opacity:0.6;"><p data-lake-id="fe10a2c1341cc352941ced20a2cab174" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">如何执行 JavaScript 代码的可以看：<a href="https://zhuanlan.zhihu.com/p/96502646" target="_blank">V8是如何执行JavaScript代码的？</a></p></blockquote> <h2 id="运行"><a href="#运行" class="header-anchor">#</a> 运行</h2> <p data-lake-id="9f7f1b6f36ee4a11de0c5671140ae27e" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-card-type="inline" data-lake-card="image"><img data-role="image" src="https://cdn.nlark.com/yuque/0/2020/png/118789/1585533410855-5c28cea5-eb18-45ef-9a9c-4d53fbc9d1c0.png" data-raw-src="https://cdn.nlark.com/yuque/0/2020/png/118789/1585533410855-5c28cea5-eb18-45ef-9a9c-4d53fbc9d1c0.png" alt="image.png" title="image.png" class="image lake-drag-image" style="visibility:visible;border:none;box-shadow:none;width:739px;height:522px;"></span></p><p data-lake-id="a3ff3a7fd4b2f35cd0139229a6eac51f" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p> <h2 id="调用堆栈"><a href="#调用堆栈" class="header-anchor">#</a> 调用堆栈</h2> <h2 id="任务队列-消息队列"><a href="#任务队列-消息队列" class="header-anchor">#</a> 任务队列(消息队列)</h2> <p data-lake-id="1b302b94594acbdecb810b1f2a6d3a86" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(82, 82, 82);font-size:15px;">&quot;任务队列&quot;中的事件，除了IO设备的事件以外，还包括一些用户产生的事件（比如鼠标点击、页面滚动等等）。只要指定过回调函数，这些事件发生时就会进入&quot;任务队列&quot;，等待主线程读取。</span></p><p data-lake-id="6becc8cff1a77d61b8a427f9fb947274" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(82, 82, 82);font-size:15px;"><br></span></p><blockquote style="margin-top:5px;margin-bottom:5px;padding-left:1em;margin-left:0px;border-left:3px solid rgb(238, 238, 238);opacity:0.6;"><p data-lake-id="4c075c7ff4420820ae690a185316b9e2" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">任务队列并不是队列，而是一个 set，因为是要取出第一个可执行的任务，而不是第一个任务</p></blockquote><p data-lake-id="017334328637226d8db6002daf1e7cd8" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(82, 82, 82);font-size:15px;"><br></span></p> <h2 id="并发和事件循环"><a href="#并发和事件循环" class="header-anchor">#</a> 并发和事件循环</h2> <p data-lake-id="2f60245897269a96d00d0d631f432a86" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><a href="https://gist.github.com/DmitrySoshnikov/26e54990e7df8c3ae7e6e149c87883e4" target="_blank">https://gist.github.com/DmitrySoshnikov/26e54990e7df8c3ae7e6e149c87883e4</a></p><p data-lake-id="3cc8d1ccdbc05727103380202b99cb58" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="e7440c1a057077081f3bb314a825c1d9" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">Event Loop只做一件事情，负责监听Call Stack和Callback Queue。当Call Stack里面的调用栈运行完变成空了，Event Loop就把Callback Queue里面的第一条事件(其实就是回调函数)放到调用栈中并执行它，后续不断循环执行这个操作。</p><p data-lake-id="dfab08869b3a00fd473a140ffa01cbef" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p><p data-lake-id="9c372cdce33f41aca0140a8f00fd5486" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(82, 82, 82);font-size:15px;">主线程从&quot;任务队列&quot;中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）。</span></p><p data-lake-id="7faba35805b19fa37c75a2987f015c1a" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(82, 82, 82);font-size:15px;"><br></span></p><p data-lake-id="f71f2a73f373b4faa9cc60e13c704afa" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><span data-mce-style="font-size: 15px" class="lake-fontsize-1515" style="color:rgb(82, 82, 82);font-size:15px;"><br></span></p><blockquote style="margin-top:5px;margin-bottom:5px;padding-left:1em;margin-left:0px;border-left:3px solid rgb(238, 238, 238);opacity:0.6;"><p data-lake-id="9eb897a7e64f30bfa10e6ce74d93e1c9" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;">为什么是调用栈去读取事件循环列表呢？而不是事件循环时间到了主动去推送呢？</p><ol data-lake-id="75363959511f6d6f5f34fceb49e7015f" start="1" lake-indent="0" style="list-style-type:decimal;margin:0px;padding-left:23px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;"><li data-lake-id="8472b8cb9c04f4021cde74b5001fa6ef">事件循环不知道调用栈何时为空。如果要知道就要设置一个事件去监听调用栈为空</li><li data-lake-id="04eae1c31ad602319b3aa9402c82a54d">有事件循环就代表 从任务队列到执行栈这个过程是一个 <strong>拉 </strong>数据的过程而不是推，推的话就不需要循环了</li></ol></blockquote><p data-lake-id="f725fa4a807b2e1a724113a1f6680109" style="font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;margin:0px;"><br></p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul data-lake-id="743d4d8068f28758b42a2d835f30ab4d" lake-indent="0" style="list-style-type:disc;margin:0px;padding-left:23px;font-size:14px;color:rgb(38, 38, 38);line-height:1.74;letter-spacing:0.05em;outline-style:none;overflow-wrap:break-word;"><li data-lake-id="654a87563ae9548e9c9affa99eee3b23"><a href="https://zhuanlan.zhihu.com/p/28753663" target="_blank">JavaScript 是如何工作的？</a></li><li data-lake-id="39db37e218d81e7631832f3b62bcdcfd"><a href="https://juejin.im/post/5a5d64fbf265da3e243b831f" target="_blank">JavaScript 运行原理解析</a></li></ul></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/na22ae.html" class="prev">
        BFC
      </a></span> <span class="next"><a href="/wndkvu.html">
        原型、构造函数、实例
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4b1516c6.js" defer></script><script src="/assets/js/2.4455a399.js" defer></script><script src="/assets/js/36.19144546.js" defer></script>
  </body>
</html>
